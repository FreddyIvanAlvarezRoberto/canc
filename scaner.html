<!DOCTYPE html>
<html lang="es">
<head> 
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escaner</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style> 
#fireworksCanvas{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:10000;
}



.hide-for-capture,
.heart.hide-for-capture,
#fireworksCanvas.hide-for-capture {
  display:none !important;
}


*{box-sizing:border-box;margin:0;padding:0}
body{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(180deg,#fff0f8,#ffe3ed);
  font-family:'Poppins',sans-serif;
  overflow:hidden;
  color:#4a154b;
}

h2{
  text-align:center;
  font-weight:600;
  font-size:1.2em;
  color:#b10077;
  margin-bottom:25px;
}

.fingerprint-box{
  position:relative;
  width:220px;
  height:200px;
  background:radial-gradient(circle at 30% 30%, #ffc1e3, #c470a6 90%);
  border-radius:25px;
  box-shadow:0 0 25px #ffc1e3, inset 0 0 10px rgba(255,255,255,0.3);
  border:5px solid #ffb5e1;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
  cursor:pointer;
}
.fingerprint{
  width:75%;
  height:auto;
  opacity:0.95;
  user-select:none;
  pointer-events:none;
}

/* üíô L√çNEA DE ESCANEO AZUL */
.scan-line{
  position:absolute;
  top:-15px; left:0;
  width:100%; height:8px;
  background:linear-gradient(90deg,
    rgba(255,255,255,0),
    rgba(0,210,255,1),
    rgba(0,140,255,1),
    rgba(255,255,255,0)
  );
  border-radius:12px;
  opacity:0;
  box-shadow:
    0 0 15px rgba(0,200,255,1),
    0 0 35px rgba(0,160,255,0.9),
    0 0 60px rgba(0,200,255,0.7);
  mix-blend-mode:screen;
}
.scanning .scan-line{
  opacity:1;
  animation:scan 2.4s ease-in-out forwards;
}
@keyframes scan{
  0%{top:-15px;opacity:0.2}
  10%{opacity:1}
  50%{top:50%;opacity:1}
  100%{top:100%;opacity:0.2}
}

/* üíô Texto de escaneo */
#scanText{
  position:absolute;
  top:calc(50% - 170px); 
  left:50%; 
  transform:translateX(-50%);
  font-size:1em;
  color:black;
  font-weight:600;
  text-shadow:
    0 0 6px rgba(0,200,255,0.8),
    0 0 12px rgba(0,240,255,0.8);
  opacity:0;
  text-align:center;
  transition:opacity .4s ease;
  width:100%;
  pointer-events:none;
}
body.scanning-active #scanText{
  opacity:1;
  animation:fadeText 2.5s ease-in-out forwards;
}
@keyframes fadeText{
  0%{opacity:0;transform:translate(-50%,-10px);}
  15%,70%{opacity:1;transform:translate(-50%,0);}
  100%{opacity:0;transform:translate(-50%,-10px);}
}

/* üå∏ Certificado */
#certificate{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -45%) scale(0.9); /* se baj√≥ -45% */
  width:100%;
  height:auto;
  background:linear-gradient(180deg,#fff7fb,#ffebf2);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  opacity:0;
  pointer-events:none;
  transition:opacity 1s ease, transform 1s ease;
  z-index:1000; /* aseguramos que quede encima de todo */
}

#certificate.active{
  opacity:1;
  transform:translate(-50%, -45%) scale(1);
  pointer-events:auto;
}

/* üîπ M√°s peque√±o */
.certificate-box{
  position:relative;
  width:78%;
  max-width:320px;
  padding:20px 16px;
  border:2px solid #e29ab7;
  border-radius:16px;
  background:#fffdfd;
  box-shadow:0 0 25px rgba(255,160,200,0.3);
}



.certificate-box::before{
  content:"";
  position:absolute;
  top:-15px;left:-15px;
  width:calc(100% + 30px);
  height:calc(100% + 30px);
  border:3px dashed #ffb6d0;
  border-radius:20px;
  background:linear-gradient(120deg,#ffe4ee 0%,#fff9fc 100%);
  z-index:-1;
}
.certificate-box h1{
  font-family:'Great Vibes',cursive;
  font-size:1.8em;
  color:#b10077;
  margin-bottom:10px;
}
.certificate-box p{
  font-size:1em;
  color:#5c3a53;
  line-height:1.6em;
}
.huella-cuadro{
  width:100px;
  height:100px;
  border:2px solid #b10077;
  margin:15px auto;
  border-radius:10px;
  background:rgba(255,182,210,0.2);
  display:flex;
  justify-content:center;
  align-items:center;
}
.huella-final{width:80%;opacity:0.8;}
.firma-text{font-size:0.9em;text-align:center;margin-top:5px;color:#7a4069;}
.fecha-text{font-size:0.85em;color:#a63b8d;margin-top:10px;font-style:italic;}


.heart{
  position:fixed;             /* üíñ ahora se posicionan en toda la pantalla */
  bottom:-40px;               /* üå∏ salen desde abajo del todo */
  font-size:24px;
  animation:floatHeart 10s ease-in-out infinite; /* üí´ m√°s lento y suave */
  opacity:0.85;
  z-index:9999;
}

@keyframes floatHeart{
  0%{
    transform:translateY(0) scale(0.8);
    opacity:0;
  }
  10%{
    opacity:1;
  }
  70%{
    opacity:1;
    transform:translateY(-80vh) scale(1.3); /* üå∑ suben casi toda la pantalla */
  }
  100%{
    opacity:0;
    transform:translateY(-100vh) scale(1.5);
  }
}




button{
  margin-top:50px;
  background:#b10077;
  color:white;
  border:none;
  border-radius:8px;
  padding:10px 20px;
  font-size:1em;
  cursor:pointer;
  box-shadow:0 0 10px rgba(177,0,119,0.5);
}
button:hover{background:#d22b8a;}
</style>
</head>

<body>
<h2> Pon tu dedo  üíó<br> Presiona y no sueltes...üíó</h2>
<div id="scanText">Te amo Churpita... üíó‚ú® </div>

<div class="fingerprint-box" id="fingerprintBox">
  <img src="https://adfy2.icu/img/huella/huella.png" alt="Huella" class="fingerprint" />
  <div class="scan-line"></div>
</div>

<div id="certificate">
  <div class="certificate-box" id="captureArea"> 
    <h1>Te voy a amar hasta que dios me preste vida</h1>
    <p>No me va a alcanzar la vida para que me perdones, pero ojal√° me dure para demostrarte que te quiero para siempre en ella.<br><br>
    Eres lo mas bonito que tengo y no te quiero perder amor de mi vida </p>

    <div class="huella-cuadro">
      <img src="canc.png" style="width: 60px; height: auto;">
    </div>

    <p class="firma-text">Escanea el QR.</p>
  </div>
  <button onclick="downloadPDF()">üìÑ Descargar</button>
</div>

<canvas id="fireworksCanvas"></canvas>

<script>
const box = document.getElementById('fingerprintBox');
const cert = document.getElementById('certificate');
let timer, locked = false;

/* === ESCANEO === */
['mousedown','touchstart'].forEach(e => box.addEventListener(e, startScan));
['mouseup','mouseleave','touchend','touchcancel'].forEach(e => box.addEventListener(e, cancelScan));

function startScan(e){
  if(locked) return;
  e.preventDefault();
  box.classList.add('scanning');
  document.body.classList.add('scanning-active');
  timer = setTimeout(()=>{
    cert.classList.add('active');
    locked = true;
    updateDateTime();
    createHearts();
    document.body.classList.remove('scanning-active');
    showFireworks(); // üéÜ aqu√≠ se disparan los fuegos
  },2500);
}


function cancelScan(){
  if(locked) return;
  box.classList.remove('scanning');
  clearTimeout(timer);
}

function createHearts(){
  for(let i=0;i<20;i++){ // üíû m√°s corazones al mismo tiempo 
    const heart=document.createElement('div');
    heart.classList.add('heart');
    heart.textContent='üíñ';
    heart.style.left=Math.random()*100+'vw';   // posici√≥n horizontal aleatoria
    heart.style.animationDelay=Math.random()*6+'s'; // salidas escalonadas
    document.body.appendChild(heart);
    setTimeout(()=>heart.remove(),15000); // üíï permanecen 15s antes de eliminarse
  }
}


function updateDateTime(){
  const fecha = new Date();
  const opciones = {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: true, // üíñ muestra hora local con AM/PM si aplica
    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone // üí´ usa la zona horaria del dispositivo
  };
  
  const fechaLocal = fecha.toLocaleString('es-ES', opciones);
  document.getElementById('fechaHora').textContent = "Emitido el " + fechaLocal;
}

/* === DESCARGA PDF === */
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const button = document.querySelector('button');
  const hearts = document.querySelectorAll('.heart');

  button.classList.add('hide-for-capture');
  hearts.forEach(h => h.classList.add('hide-for-capture'));
  await new Promise(r => setTimeout(r, 200));

  const capture = document.body;
  const canvas = await html2canvas(capture, {
    scale: 2,
    useCORS: true,
    backgroundColor: null,
    windowWidth: document.documentElement.scrollWidth,
    windowHeight: document.documentElement.scrollHeight
  });

  button.classList.remove('hide-for-capture');
  hearts.forEach(h => h.classList.remove('hide-for-capture'));

  const imgData = canvas.toDataURL('image/png');
  const pdf = new jsPDF('p', 'mm', 'a4');
  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();
  const imgWidth = canvas.width;
  const imgHeight = canvas.height;
  const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
  const imgScaledWidth = imgWidth * ratio;
  const imgScaledHeight = imgHeight * ratio;
  const marginX = (pdfWidth - imgScaledWidth) / 2;
  const marginY = (pdfHeight - imgScaledHeight) / 2;
  pdf.addImage(imgData, 'PNG', marginX, marginY, imgScaledWidth, imgScaledHeight);
  pdf.save('Certificado_de_Amor.pdf');
}

/* === FUEGOS ARTIFICIALES === */
const canvas = document.getElementById("fireworksCanvas");
const ctx = canvas.getContext("2d");
let particles = [];

function resizeCanvas(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function createFirework(x, y, colors){
  for(let i=0;i<40;i++){
    particles.push({
      x, y,
      color: colors[Math.floor(Math.random()*colors.length)],
      radius: Math.random()*2+1,
      speed: Math.random()*3+1.5, // antes 5+2

      angle: Math.random()*Math.PI*2,
      life: 440 + Math.random() * 160  // üí´ Dura m√°s tiempo (antes 60‚Äì90, ahora 140‚Äì200)

    });
  }
}

function drawFireworks(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach((p,i)=>{
    p.life--;
    if(p.life<=0) particles.splice(i,1);
    p.x += Math.cos(p.angle)*p.speed;
    p.y += Math.sin(p.angle)*p.speed * 0.4 + 0.2; // üí• sube m√°s lento

    ctx.beginPath();
    ctx.fillStyle = p.color;
    ctx.globalAlpha = Math.max(p.life/90,0);
    ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(drawFireworks);
}
drawFireworks();

function showFireworks(){
  const colors = ['#ff007f','#00eaff','#ffe600','#ff6600','#9b00ff'];
  for(let i=0;i<8;i++){
    setTimeout(()=>{
      createFirework(
        Math.random()*canvas.width,
        Math.random()*canvas.height*0.6,
        colors
      );
    }, i*300);
  }
}


resizeCanvas();
drawFireworks();

</script>
</body>
</html>
